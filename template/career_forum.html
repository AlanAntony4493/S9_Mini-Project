{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>SMYM Mukkoottuthara</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="{% static 'img/logo1.png' %}" rel="icon">
    <link href="{% static 'img/logo1.png' %}" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="{% static 'vendor/aos/aos.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/boxicons/css/boxicons.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/remixicon/remixicon.css' %}" rel="stylesheet">
    <link href="{% static 'vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">

     <!-- JavaScript Files -->
     <script src="{% static 'js/validation.js' %}"></script>

    <style>
        /* Your existing styles here */

        .question {
            background-color: #f0f0f0;
            padding: 10px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            margin-top: 5px;
            overflow-wrap: break-word;
        }

        /* Style for Answers Container */
        .answers {
            max-height: 500px; /* Change this to the specific height you desire */
            overflow-y: auto; /* Add a vertical scrollbar if needed */
            list-style-type: none;
            padding: 0;
            overflow-wrap: break-word;
            scrollbar-width: thin; /* Set the width of the scrollbar */
            scrollbar-color: #888888 transparent; /* Set the color of the thumb and hide the track */
        }

        .answers::-webkit-scrollbar-thumb {
            background-color: #888888; /* Color of the thumb */
            border: none; /* Remove the border */
            border-radius: 0; /* Remove border radius */
        }
        
        /* Style for the scrollbar track (the non-draggable part) */
        .answers::-webkit-scrollbar-track {
            background-color: transparent; /* Make the track transparent */
            border: none; /* Remove any border */
        }
        
        /* Optionally, you can style other browser-specific scrollbars like Firefox */
        .answers::-webkit-scrollbar {
            width: 4px; /* Width of the scrollbar */
        }

        .answer {
            {% comment %} background-color: #e0e0e0; {% endcomment %}
            background-color: #d0e6f6;
            padding: 10px;
            border: 1px solid #ccc;
            margin-top: 10px;
            margin-bottom:20px;
        }

        /* Style for Author Names */
        .author {
            font-weight: bold;
            font-style: italic;
            text-decoration: underline;
        }

        /* Oval-shaped image container */
        .image-container {
            width: 100px; /* Adjust the width to your preference */
            height: 100px; /* Adjust the height to your preference */
            border-radius: 50%; /* Makes it oval */
            overflow: hidden; /* Hide overflowing content */
            float: left; /* Float the image container to the left */
            margin-right: 20px; /* Spacing between image and text */
        }

        /* Make the image container round */
        .round-image {
            border-radius: 50%;
        }

        /* Oval image to fill the container */
        .oval-image {
            width: 100%; /* Make the image fill the container */
            height: 100%; /* Maintain aspect ratio */
            display: block; /* Remove any default inline styles */
            border-radius: 50%; /* Ensure the image stays oval */
        }

        /* Align text to the top and parallel to the image */
        .resource-person-description {
            overflow: hidden; /* Hide overflowing content */
        }

        .container-resource-person {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
        }

        /* CSS for larger screens */
        @media screen and (min-width: 992px) {
            #career-guidance-container {
                display: flex;
                align-items: flex-start;
                justify-content: space-between;
            }
            #resource-persons {
                margin-top: 0;
            }
        }

        /* CSS for smaller screens */
        @media screen and (max-width: 991px) {
            #career-guidance-container {
                flex-direction: column;
                align-items: flex-start;
            }
            #resource-persons {
                margin-top: 20px;
            }
        }
        .limited-width {
            max-width: 100%; /* Allow paragraphs to take the full width of the container */
            overflow: hidden;
            text-overflow: ellipsis;
        }

                /* Style for the dropdown container */
        .dropdown {
            position: flex-end;
            display: inline-block;
        }

        /* Style for the dropdown button (three dots) */
        .dropdown-btn {
            background-color: transparent;
            border: none;
            cursor: pointer;
        }

        /* Style for the dropdown menu items */
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

        .dropdown-content a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            font-size:14px;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #ddd;
        }

        .user-info {
            position: relative;
            display: flex;
            justify-content: space-between; /* Vertical alignment */
        }
        .dropdown-btn {
            background-color: transparent;
            border: none;
            cursor: pointer;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            top: -100%; /* Position above the user-info container */
            right: 0; /* Position to the right of the user-info container */
        }
        .post-time {
            font-size: 12px;
            color: #888; /* You can adjust the color to your preference */
            margin-right: auto;
            font-style: italic;

        }
        .error{
            font-size:14px;
            color:red;
        }
        

    </style>
</head>

<body>
    <!-- ======= Header ======= -->
     <!-- ======= Header ======= -->
 <header id="header" class="fixed-top header-inner-pages">
    <div class="container d-flex align-items-center justify-content-lg-between">

        <a href="{% url 'index' %}" class="logo me-auto me-lg-0"><img src="{% static 'img/logonew.png' %}" alt="SMYM"
                class="img-fluid" style="height:100px"></a>

        <nav id="navbar" class="navbar order-last order-lg-0">
            <ul>
                <li><a class="nav-link scrollto active" href="{% url 'index' %}">Home</a></li>
                <li class="dropdown"><a href=""><span>About Us</span> <i class="bi bi-chevron-down"></i></a>
                    <ul>
                        <li><a href="{% url 'index' %}#about">SMYM Mukkoottuthara</a></li>
                        <li class="dropdown"><a href="{% url 'by_law' %}"><span>SMYM BY Law</span> <i
                                    class="bi bi-chevron-right"></i></a>
                            <!-- <ul>
                            <li><a href="#">SMYM-LOGO</a></li>
                            <li><a href="#">SMYM-FLAG</a></li>
                            <li><a href="#">SMYM-ANTHEM</a></li>
                            <li><a href="#">SMYM-SLOGAN</a></li>
                        </ul> -->
                        </li>
                        <!-- <li><a href="#">Drop Down 2</a></li>
                        <li><a href="#">Drop Down 3</a></li>
                        <li><a href="#">Drop Down 4</a></li> -->
                    </ul>
                </li>
                <ul>
                    <li><a class="nav-link scrollto" href="{% url 'gallery' %}">Gallery</a></li>
                    <li><a class="nav-link scrollto" href="{% url 'index' %}#contact">Contact</a></li>
                    <li><a class="nav-link scrollto" href="{% url 'index' %}#services">Services</a></li>
                    {% if user.is_superuser %}
                    <li><a class="nav-link scrollto" href="{% url 'user_admin' %}">Users</a></li>
                    <li><a class="nav-link scrollto" id="logout" href="{% url 'logout' %}?next=/">Log Out (
                            {{ user.username }})</a></li>
                    {% elif user.is_authenticated %}
                    <li><a class="nav-link scrollto" href="{% url 'logout' %}?next=/">Log Out (
                            {{ user.first_name }})</a></li>
                    {% else %}
                    <li><a class="nav-link scrollto" href="{% url 'login' %}">Log In</a></li>
                    {% endif %}

                </ul>

                <i class="bi bi-list mobile-nav-toggle"></i>
        </nav><!-- .navbar -->

        <a href="{% url "donation_form" %}" class="get-started-btn scrollto">Support Us</a>

    </div>
</header><!-- End Header -->
    <!-- End Header -->

    <main id="main">
        <!-- ======= Breadcrumbs ======= -->
        <section class="breadcrumbs">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <h2>Career Guidance Forum</h2>
                    {% if user.is_authenticated %}
                    <a href="#ask-a-question" class="btn btn-primary scrollto">Ask Question</a>
                    {% endif %}
                    {% if user.is_superuser %}
                    <a href="{% url 'reported_comments' %}">View Reported Comments</a>
                    {% endif %}
                </div>
            </div>
        </section>
    
        <!-- Career Guidance Forum Section 1 -->
        <div class="container">
            <h1 style="font-family:URW Chancery L, cursive;">Sharing Knowledge and Shaping Futures</h1>
            <div class="row">
                <!-- Questions and Answers -->
              <!-- Questions and Answers -->
<div class="col-lg-8">
    <div class="container-resource-person" id="qa-section">
        {% for question in questions %}
        <div class="person-info">
            <div class="user-info">
                <span class="user-profile">
                    <i class="bi bi-person-circle"></i>&nbsp;<b>{{ question.posted_by.first_name }}&nbsp;{{ question.posted_by.registration.middle_name }}&nbsp;{{ question.posted_by.last_name }}</b>
                    <span class="post-time" data-posted="{{ question.posted_date_time|date:'U' }}"></span>
                </span>
                <div class="dropdown">
                    <button class="dropdown-btn" onclick="toggleDropdown(event, this)">&#8942;</button>
                    <div class="dropdown-content">
                        <a href="#" onclick="reportQuestion({{ question.id }})">Report Question</a>
                        {% if user.is_superuser %}
                            <!-- Edit Question Link -->
                            <button class="btn btn-link" onclick="toggleEditQuestionForm({{ question.id }})">Edit Question</button>
                            <a href="{% url 'soft_delete_question' question.id %}" onclick="return confirm('Are you sure you want to delete this question?')">Delete Question</a>
                            
                        {% elif question.posted_by == user %}
                            <!-- Show delete option with confirmation -->
                            <button class="btn btn-link" onclick="toggleEditQuestionForm({{ question.id }})">Edit Question</button>
                            <a href="{% url 'soft_delete_question' question.id %}" onclick="return confirm('Are you sure you want to delete this question?')">Delete Question</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            
        
        <div class="question" id="edit-question-{{ question.id }}">
            <h2>{{ question.title }}</h2>
            <p>{{ question.description }}</p>
            <p>{{ question.additional_details }}</p> 
        </div>
                        <!-- Edit Question Form (Initially hidden) -->
            <form class="edit-question-f 77
                <div class="mb-3">
                    <label for="editQuestionTitle-{{ question.id }}" class="form-label">Edit Title</label>
                    <input type="text" class="form-control" name="editQuestionTitle" id="editQuestionTitle-{{ question.id }}" value="{{ question.title }}" required>
                </div>
                <div class="mb-3">
                    <label for="editQuestionDescription-{{ question.id }}" class="form-label">Edit Description</label>
                    <textarea class="form-control" name="editQuestionDescription" id="editQuestionDescription-{{ question.id }}" rows="4" required>{{ question.description }}</textarea>
                </div>
                <button type="button" class="btn btn-primary" onclick="console.log('Save button clicked for question {{ question.id }}'); saveEditQuestion({{ question.id }})">Save</button>
                <button type="button" class="btn btn-secondary" onclick="console.log('Cancel button clicked for question {{ question.id }}'); cancelEditQuestion({{ question.id }})">Cancel</button>
            </form>
            <p style="font-style: italic;">Answers</p>

            <!-- Answers Container -->
            <div class="answers-container">
                <ul class="answers">
                    <!-- Loop through answers associated with this question -->
                    {% for answer in answers %}
                        {% if answer.question_id == question.id %}
                        <li>
                            <div class="answer">
                               <!-- Inside your loop that displays comments -->
                                <div class="user-info">
                                    <span class="user-profile">
                                        <i class="bi bi-person-circle"></i>&nbsp;<b>{{ answer.posted_by.first_name }}&nbsp;{{ answer.posted_by.registration.middle_name }}&nbsp;{{ answer.posted_by.last_name }}</b>
                                        <span class="post-time" data-posted="{{ answer.posted_date_time|date:'U' }}"></span>
                                    </span>
                                    <div class="dropdown">
                                        <button class="dropdown-btn" onclick="toggleDropdown(event, this)">&#8942;</button>
                                        <div class="dropdown-content">
                                            <a href="#" onclick="reportComment({{ answer.id }})">Report Answer</a>
                                            {% if user.is_superuser %}
                                                <!-- Edit Comment Link -->
                                                <a href="#" onclick="toggleEditForm({{ answer.id }}, event)">Edit Comment</a>
                                                <a href="{% url 'soft_delete_answer' answer.id %}" onclick="return confirm('Are you sure you want to delete this comment?')">Delete Comment</a>
                                                
                                            {% elif answer.posted_by == user %}
                                                <!-- Show delete option with confirmation -->
                                                <a href="#" onclick="toggleEditForm({{ answer.id }}, event)">Edit Comment</a>
                                                <a href="{% url 'soft_delete_answer' answer.id %}" onclick="return confirm('Are you sure you want to delete this comment?')">Delete Comment</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="answer" id="answer-{{ answer.id }}">
                                    <div class="comment-text" id="comment-{{ answer.id }}">
                                        <p style="font-size: 15px;">{{ answer.answer_text }}</p>
                                    </div>
                                    <!-- Edit Comment Form (Initially hidden) -->
                                    <form class="edit-comment-form" id="edit-comment-form-{{ answer.id }}" style="display: none;">
                                        {% csrf_token %}
                                        <div class="mb-3">
                                            <label for="editAnswerText-{{ answer.id }}" class="form-label">Edit Your Comment</label>
                                            <textarea class="form-control" name="editAnswerText" id="editAnswerText-{{ answer.id }}" rows="4" required>{{ answer.answer_text }}</textarea>
                                        </div>
                                        <button type="button" class="btn btn-primary" onclick="saveEditComment({{ answer.id }})">Save</button>
                                        <button type="button" class="btn btn-secondary" onclick="cancelEditComment({{ answer.id }})">Cancel</button>
                                    </form>
                                </div>

                        </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>

            <!-- Answer Form for this question -->
            {% if user.is_authenticated %}
                    <form action="{% url 'post_answer' %}" class="answerForm" method="post" data-question-id="{{ question.id }}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="answerText" class="form-label">Your Answer</label>
                            <textarea class="form-control" name="answerText" rows="4" required></textarea>
                        </div>
                        <input type="hidden" name="questionId" value="{{ question.id }}">
                        <button type="submit" class="btn btn-primary" style="margin-bottom:50px;">Post Answer</button>
                    </form>
            {% endif %}
                </div>
                {% endfor %}
            </div>

           
            {% if user.is_authenticated %}
             <!-- Ask a Question Section -->
             <section id="ask-a-question" class="bg-light">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <h2 class="section-title">Ask a Career-Related Question</h2>
                            <!-- Separate div for Writing a good question -->
                            <div class="bg-secondary text-white p-3 mb-4">
                                <h3>Writing a Good Question</h3>
                                <p>Youâ€™re ready to ask a career-related question, and this form will help guide you through the process.</p>
                                <h4>Steps</h4>
                                <ol>
                                    <li>Summarize your problem in a one-line title.</li>
                                    <li>Describe your problem in more detail.</li>
                                    <li>Include any additional details.</li>
                                    <li>Review your question and post it to the site.</li>
                                </ol>
                            </div>
                            <!-- Form for asking a question -->
                            <form id="askQuestionForm" action="{% url 'post_question' %}" method="post" enctype="multipart/form-data" onsubmit="validateQuestionForm(event)">
                                {% csrf_token %}
                                <div class="mb-3">
                                    <label for="questionTitle" class="form-label">Title (Required)</label>
                                    <input type="text" class="form-control" id="questionTitle" name="questionTitle" oninput="validateTitle()" required>
                                    <p class="error" id="title-error"></p>
                                </div>
                                <div class="mb-3">
                                    <label for="questionDescription" class="form-label">Detailed Description (Required)</label>
                                    <textarea class="form-control" id="questionDescription" name="questionDescription" rows="4" oninput="validateDescription()" required></textarea>
                                    <p class="error" id="description-error"></p>
                                </div>
                                <div class="mb-3">
                                    <label for="additionalDetails" class="form-label">Additional Details (Optional)</label>
                                    <textarea class="form-control" id="additionalDetails" name="additionalDetails" rows="4" oninput="validateAdditionalDetails()"></textarea>
                                    <p class="error" id="adddetails-error"></p>
                                </div>
                                <input type="submit" value="Post_Question" id="sub" class="btn btn-primary">
                            </form>
                        </div>

                        
                    </div>
                </div>
            </section>  
        {% endif %}
        {% if user.is_superuser %}
            <section>
                <h2 class="section-title">ADD NEW RESOURCE PERSON</h2>
                <form id="addResourcePersonForm" action="{% url 'add_resource_person' %}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="name" class="form-label">Name (Required)</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                        <p class="error" id="name-error"></p>
                    </div>
                    <div class="mb-3">
                        <label for="jobTitle" class "form-label">Job Title</label>
                        <input type="text" class="form-control" id="jobTitle" name="jobTitle">
                        <p class="error" id="jobTitle-error"></p>
                    </div>
                    <div class="mb-3">
                        <label for="phoneNumber" class="form-label">Phone Number (Required)</label>
                        <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" required>
                        <p class="error" id="phoneNumber-error"></p>
                    </div>
                    <div class="mb-3">
                        <label for="photo" class="form-label">Photo (Required)</label>
                        <input type="file" class="form-control" id="photo" name="photo" accept="image/*" required>
                        <p class="error" id="photo-error"></p>
                    </div>
                    <input type="submit" value="Add Resource Person" class="btn btn-primary"/>
                </form>                           
            </section>
        {% endif %}
        </div>
         
    
                <!-- Resource Persons -->
                <div class="col-lg-4" style="">
                    <h3>"Seeking Mentorship"</h3>
                    <p><i>Find experienced mentors to guide your journey.</i></p>
                    
                        {% comment %} <div class="image-container round-image">
                            <img src="{% static 'img/team/sobin.png' %}" alt="Resource Person 1" class="oval-image">
                        </div>
                        <div class="resource-person-description">
                            <p>Name: Jane Smith</p>
                            <p>Job: CTO, Tech Solutions</p>
                            <p>985577585</p>
                        </div> {% endcomment %}

                        {% for resource_person in resource_persons %}
                        <div class="resource-person"  style="margin-bottom: 20px; background-color:#e9f2ec; padding: 10px; border-radius: 8px;">
                            <div class="image-container round-image" >
                                <img src="{{ resource_person.photo.url }}" alt="{{ resource_person.name }}" class="oval-image">
                            </div>
                            <div class="resource-person-description" >
                                <p style="font-weight: bold; font-size: 1.2em; margin-bottom: 5px;">{{ resource_person.name }}</p>
                                <p style="font-style: italic; font-size: 1.1em; margin-bottom: 5px;">{{ resource_person.job_title }}</p>
                                <p style="font-size: 1em;">Phone: {{ resource_person.phone_number }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                
            </div>
        </div>
    </main>

    <!-- Vendor JS Files -->
    <script src="{% static 'vendor/purecounter/purecounter_vanilla.js' %}"></script>
    <script src="{% static 'vendor/aos/aos.js' %}"></script>
    <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'vendor/glightbox/js/glightbox.min.js' %}"></script>
    <script src="{% static 'vendor/isotope-layout/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'vendor/swiper/swiper-bundle.min.js' %}"></script>
    <script src="{% static 'vendor/php-email-form/validate.js' %}"></script>

    <!-- Template Main JS File -->
    <script src="{% static 'js/main.js' %}"></script>

    <!-- Include jQuery if not already included -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        // JavaScript for responsive behavior
        window.addEventListener('DOMContentLoaded', () => {
            const careerGuidanceContainer = document.getElementById('career-guidance-container');
            const resourcePersons = document.getElementById('resource-persons');

            // Function to rearrange sections based on screen width
            function rearrangeSections() {
                if (window.innerWidth >= 992) {
                    // Larger screens: Resource persons and questions side by side
                    careerGuidanceContainer.style.display = 'flex';
                    careerGuidanceContainer.style.alignItems = 'flex-start';
                    careerGuidanceContainer.style.justifyContent = 'space-between';
                    resourcePersons.style.marginTop = '0';
                } else {
                    // Smaller screens: Resource persons below questions
                    careerGuidanceContainer.style.flexDirection = 'column';
                    careerGuidanceContainer.style.alignItems = 'flex-start';
                    resourcePersons.style.marginTop = '20px';
                }
            }

            // Initial arrangement
            rearrangeSections();

            // Listen for window resize event to update layout
            window.addEventListener('resize', rearrangeSections);
        });

        // Check if the page was reloaded due to the back button click
    window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
            // Reload the page
            location.reload();
        }
    });
    
</script>
<!-- Include jQuery if not already included -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    // Function to open/close the dropdown
    function toggleDropdown(event, button) {
        event.stopPropagation(); // Prevent the event from propagating to document click
        const dropdownContent = button.nextElementSibling;
        const isVisible = dropdownContent.style.display === 'block';

        // Close all other dropdowns before opening the current one
        closeAllDropdowns();

        if (isVisible) {
            dropdownContent.style.display = 'none';
        } else {
            dropdownContent.style.display = 'block';
            // Add a click event listener to the document body to close the dropdown
            document.body.addEventListener('click', closeDropdown);
        }
    }

    // Handle option click
    function handleOptionClick(option) {
        const action = option.getAttribute("data-action");
        const answerId = option.getAttribute("data-answer-id");
        const deleteUrl = option.getAttribute("data-delete-url");

        if (action === "delete" && confirm("Are you sure you want to delete this comment?")) {
            // Send a request to the server to soft delete the answer
            fetch(deleteUrl, {
                method: "POST",
                headers: {
                    "X-CSRFToken": getCookie("csrftoken"), // Make sure to include CSRF token
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Optionally, you can update the UI to remove the deleted comment
                        const comment = option.parentElement.parentElement;
                        comment.style.display = "none";
                    } else {
                        alert("Failed to delete the comment.");
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("An error occurred while deleting the comment.");
                });
        }
    }

    // Close the currently open dropdown
    function closeDropdown() {
        const dropdowns = document.querySelectorAll('.dropdown-content');
        dropdowns.forEach(function (dropdown) {
            dropdown.style.display = 'none';
        });

        // Remove the click event listener from the document body
        document.body.removeEventListener('click', closeDropdown);
    }

    // Close all dropdowns except the one being clicked
    function closeAllDropdowns() {
        const dropdowns = document.querySelectorAll('.dropdown-content');
        dropdowns.forEach(function (dropdown) {
            dropdown.style.display = 'none';
        });
    }

    // Function to get CSRF token from cookies (you can replace it with your implementation)
    function getCookie(name) {
        const cookieValue = document.cookie.match(`(^|;)\\s*${name}\\s*=\s*([^;]+)`);
        return cookieValue ? cookieValue.pop() : "";
    }

    // Close the dropdown when clicking outside of it
    window.onclick = function(event) {
        if (!event.target.matches('.dropdown-btn')) {
            const dropdowns = document.querySelectorAll(".dropdown-content");
            dropdowns.forEach(function(dropdown) {
                dropdown.style.display = 'none';
            });
        }
    };
</script>




<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script>
    function formatTimeAgo(element) {
        const postedAtTimestamp = element.getAttribute("data-posted");
        const now = moment();
        const postedAt = moment.unix(postedAtTimestamp); // Convert timestamp to a moment object

        const timeAgo = moment.duration(now.diff(postedAt));

        let timeAgoString = "";

        if (timeAgo.asSeconds() < 60) {
            timeAgoString = `(posted ${Math.floor(timeAgo.asSeconds())} sec ago)`;
        } else if (timeAgo.asMinutes() < 60) {
            timeAgoString = `(posted ${Math.floor(timeAgo.asMinutes())} min ago)`;
        } else if (timeAgo.asHours() < 24) {
            timeAgoString = `(posted ${Math.floor(timeAgo.asHours())} hr ago)`;
        } else {
            timeAgoString = `(posted ${Math.floor(timeAgo.asDays())} days ago)`;
        }

        element.textContent = timeAgoString;
    }

    document.addEventListener("DOMContentLoaded", function () {
        const postTimeElements = document.querySelectorAll(".post-time");
        postTimeElements.forEach(formatTimeAgo);
    });
</script>



<!-- JavaScript for Edit Comment -->
<script>
   // Function to toggle the edit comment form
function toggleEditForm(commentId, event) {
    const editForm = document.getElementById(`edit-comment-form-${commentId}`);
    const commentText = document.getElementById(`comment-${commentId}`);
    
    if (editForm.style.display === 'none' || !editForm.style.display) {
        // Show the edit form
        editForm.style.display = 'block';
        commentText.style.display = 'none';
    } else {
        // Hide the edit form
        editForm.style.display = 'none';
        commentText.style.display = 'block';
    }

    // Prevent the default anchor click behavior
    event.preventDefault();
}


    // Function to save the edited comment
function saveEditComment(commentId) {
    const editedText = document.getElementById(`editAnswerText-${commentId}`).value;

    // Send a POST request to the server to update the comment
    fetch(`/edit_comment/${commentId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': getCookie('csrftoken'), // Make sure to include CSRF token
        },
        body: `edited_text=${encodeURIComponent(editedText)}`,
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Comment updated successfully
            const commentText = document.getElementById(`comment-${commentId}`);
            if (commentText) {
                commentText.textContent = editedText;
                commentText.style.display = 'block';
                const editForm = document.getElementById(`edit-comment-form-${commentId}`);
                if (editForm) {
                    editForm.style.display = 'none';
                }
            }
        } else {
            alert('Failed to update the comment. Please try again.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while updating the comment.');
    });
}


    // Function to cancel editing and hide the edit form
    function cancelEditComment(commentId) {
        const commentText = document.getElementById(`comment-${commentId}`);
        const editForm = document.getElementById(`edit-comment-form-${commentId}`);

        if (commentText && editForm) {
            commentText.style.display = 'block';
            editForm.style.display = 'none';
        }
    }



    function reportComment(answerId) {
        const reason = prompt("Please provide a reason for reporting this comment:");
        if (reason !== null && reason.trim() !== "") {
            // User provided a reason, send it to the server
            fetch(`/report/comment/${answerId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': getCookie('csrftoken'), // Make sure to include CSRF token
                },
                body: `reason=${encodeURIComponent(reason)}`,
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Comment reported successfully. Thank you for your feedback.");
                } else {
                    alert("Failed to report the comment. Please try again.");
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while reporting the comment.');
            });
        } else {
            alert("Please provide a reason for reporting the comment.");
        }
    }
    
    // Function to get CSRF token from cookies (you can replace it with your implementation)
    function getCookie(name) {
        const cookieValue = document.cookie.match(`(^|;)\\s*${name}\\s*=\s*([^;]+)`);
        return cookieValue ? cookieValue.pop() : "";
    }
    
</script>

<!-- Update the JavaScript function to toggle question dropdowns -->
<script>
    // Function to open/close the dropdown for questions
    function toggleQuestionDropdown(event, button) {
        event.stopPropagation(); // Prevent the event from propagating to document click
        const dropdownContent = button.nextElementSibling;
        const isVisible = dropdownContent.style.display === 'block';

        // Close all other question dropdowns before opening the current one
        closeAllQuestionDropdowns();

        if (isVisible) {
            dropdownContent.style.display = 'none';
        } else {
            dropdownContent.style.display = 'block';
            // Add a click event listener to the document body to close the question dropdown
            document.body.addEventListener('click', closeQuestionDropdown);
        }
    }

    // Close the currently open question dropdown
    function closeQuestionDropdown() {
        const questionDropdowns = document.querySelectorAll('.question-dropdown-content');
        questionDropdowns.forEach(function (dropdown) {
            dropdown.style.display = 'none';
        });

        // Remove the click event listener from the document body
        document.body.removeEventListener('click', closeQuestionDropdown);
    }

    // Close all question dropdowns except the one being clicked
    function closeAllQuestionDropdowns() {
        const questionDropdowns = document.querySelectorAll('.question-dropdown-content');
        questionDropdowns.forEach(function (dropdown) {
            dropdown.style.display = 'none';
        });
    }
</script>

<script>
    function toggleEditQuestionForm(questionId) {
        const editForm = document.getElementById(`edit-question-form-${questionId}`);
        const questionText = document.getElementById(`question-${questionId}`);
        
        if (editForm.style.display === 'none' || !editForm.style.display) {
            // Show the edit form
            editForm.style.display = 'block';
            questionText.style.display = 'none';
        } else {
            // Hide the edit form
            editForm.style.display = 'none';
            questionText.style.display = 'block';
        }
    }
    function saveEditQuestion(questionId) {
        console.log('saveEditQuestion function called for questionId:', questionId);
        const editedTitle = document.getElementById(`editQuestionTitle-${questionId}`).value;
        const editedDescription = document.getElementById(`editQuestionDescription-${questionId}`).value;
    
        // Send a POST request to the server to update the question
        fetch(`/edit_question/${questionId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': getCookie('csrftoken'),
            },
            body: `edited_title=${encodeURIComponent(editedTitle)}&edited_description=${encodeURIComponent(editedDescription)}`,
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('Update successful');
                const editForm = document.getElementById(`edit-question-form-${questionId}`);
                console.log('editForm');
    
                if (editForm) {
                    console.log('Hiding the form');
                    editForm.style.display = 'none';
                }
            } else {
                alert('Failed to update the question. Please try again.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while updating the question. Please try again later.');
        });        
    }
    
    
    
    function cancelEditQuestion(questionId) {
        const questionText = document.getElementById(`edit-question-${questionId}`);
        const editForm = document.getElementById(`edit-question-form-${questionId}`);
    
        if (questionText && editForm) {
            questionText.style.display = 'block';
            editForm.style.display = 'none';
        }
    }    
</script>



<script>
    // Function to validate the Name field on input
    document.getElementById('name').addEventListener('input', function () {
        validateName();
    });

    // Function to validate the Phone Number field on input
    document.getElementById('phoneNumber').addEventListener('input', function () {
        validatePhoneNumber();
    });

    // Function to validate the form on submission
    document.getElementById('addResourcePersonForm').addEventListener('submit', function (event) {
        const nameError = validateName();
        const phoneNumberError = validatePhoneNumber();
        const photoInput = document.getElementById('photo').value;
        const photoError = document.getElementById('photo-error');

        // Validate Photo (Accept only image files)
        if (photoInput === '') {
            photoError.textContent = 'Photo is required';
            event.preventDefault(); // Prevent form submission if there are errors
        } else {
            const allowedExtensions = /(\.jpg|\.jpeg|\.png|\.gif)$/i;
            if (!allowedExtensions.exec(photoInput)) {
                photoError.textContent = 'Invalid file type. Only image files are allowed.';
                event.preventDefault(); // Prevent form submission if there are errors
            } else {
                photoError.textContent = '';
            }
        }
    });

    // Function to validate the Name field
    function validateName() {
        const nameInput = document.getElementById('name').value.trim();
        const nameError = document.getElementById('name-error');

        if (nameInput.length < 3 || !/^(?!\s)[A-Za-z\s]+(?<!\s)$/.test(nameInput)) {
            nameError.textContent = 'Invalid name format (minimum 3 characters and numbers are not allowed)';
            return false;
        } else {
            nameError.textContent = '';
            return true;
        }
    }

    // Function to validate the Phone Number field
    function validatePhoneNumber() {
        const phoneNumberInput = document.getElementById('phoneNumber').value.trim();
        const phoneNumberError = document.getElementById('phoneNumber-error');

        if (phoneNumberInput === '' || !/^\d{10}$/.test(phoneNumberInput)) {
            phoneNumberError.textContent = 'Invalid phone number format (e.g., 1234567890)';
            return false;
        } else {
            phoneNumberError.textContent = '';
            return true;
        }
    }
</script>

<script>
    document.getElementById("addResourcePersonForm").addEventListener("submit", function(event) {
        const nameInput = document.getElementById("name");
        const phoneNumberInput = document.getElementById("phoneNumber");
        const photoInput = document.getElementById("photo");

        const nameError = document.getElementById("name-error");
        const phoneNumberError = document.getElementById("phoneNumber-error");
        const photoError = document.getElementById("photo-error");

        let isValid = true;

        // Name validation: Check if it's not empty
        if (nameInput.value.trim() === "") {
            nameError.textContent = "Name is required";
            isValid = false;
        } else {
            nameError.textContent = "";
        }

        // Phone Number validation: Check if it's not empty and a valid phone number format
        const phoneNumberRegex = /^\d{10}$/; // Adjust as needed
        if (phoneNumberInput.value.trim() === "" || !phoneNumberRegex.test(phoneNumberInput.value)) {
            phoneNumberError.textContent = "Phone Number is required and should be 10 digits";
            isValid = false;
        } else {
            phoneNumberError.textContent = "";
        }

        // Photo validation: Check if a file is selected and it's an image
        if (photoInput.files.length === 0 || !photoInput.files[0].type.startsWith("image/")) {
            photoError.textContent = "Please select a valid image file";
            isValid = false;
        } else {
            photoError.textContent = "";
        }

        if (!isValid) {
            event.preventDefault(); // Prevent form submission
        }
    });
</script>

</body>

</html>
